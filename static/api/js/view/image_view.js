window._bd_share_main.F.module("view/image_view",function(e,t,i){var b=e("base/tangram").T,o=e("base/class").Class,s=e("conf/const"),n=e("view/view_base");t.View=o.create(function(u){function o(e){var t=e.target;(function(e){var t=!0;u.bdMinHeight&&u.bdMinHeight>e.offsetHeight?t=!1:u.bdMinWidth&&u.bdMinWidth>e.offsetWidth?t=!1:(e.offsetWidth<100||e.offsetHeight<100)&&(t=!1);return t})(t)&&(f.element=t,f.start())}function n(){f.abort()}function e(e){e&&function(e){if(u.bdCustomStyle){var t=document.createElement("link");t.href=u.bdCustomStyle,t.rel="styleSheet",t.type="text/css",t.onLoad=function(){e&&e()},document.getElementsByTagName("head")[0].appendChild(t)}else window._bd_share_main.F.use(["imgshare.css","share_style0_"+u.viewSize+".css"],function(){e&&e()})}(function(){(function(e){if("list"==u.viewType)for(var t={16:{lbl:53,pright:8,item:18},24:{lbl:57,pright:8,item:28},32:{lbl:61,pright:8,item:38}}[u.viewSize],i=Math.floor((e.offsetWidth-t.lbl-t.pright-10)/t.item),o=m.find(".bdimgshare-icon"),n=0,s=o.length-1;n<s;n++)n<i-1?b(o[n]).show():b(o[n]).hide();var a={width:m.offsetWidth,height:m.offsetHeight},r={width:e.offsetWidth,height:e.offsetHeight},h=(l=b(e).offset(),d=r,c=a,"list"==u.viewType?{top:l.top+("bottom"==u.viewPos?d.height-c.height:0),left:l.left}:"collection"==u.viewType?{top:l.top+(-1<u.viewPos.toLowerCase().indexOf("bottom")?d.height-c.height-5:5),left:l.left+(-1<u.viewPos.toLowerCase().indexOf("left")?5:d.width-c.width-5)}:{top:l.top+("bottom"==u.viewPos?d.height-c.height:0),left:l.left+(d.width-c.width)}),f={position:"absolute",top:h.top+"px",left:h.left+"px"};var l,d,c;"list"==u.viewType&&(f.width=r.width+"px"),m.css(f)})(e),m.show(),t=!1,i=e})}var r=this,h="bdimgshare_"+(new Date).getTime(),m=null,t=!1,i=null,f=new function(e){var t=!1,i=!1;this.clearAbort=function(){i&&(i=clearTimeout(i))},this.start=function(){i&&(i=clearTimeout(i)),t||(t=setTimeout(function(){e.startFn&&e.startFn(),t=!1},e.time))},this.abort=function(){t&&(t=clearTimeout(t)),i||(i=setTimeout(function(){e.abortFn&&e.abortFn(),i=!1},e.time))}}({time:200,startFn:function(){e(f.element)},abortFn:function(){t||m.hide()}});r.render=function(e){var i;i=u.tag||"",b("img").each(function(e,t){if(!i||b(t).attr(s.CONFIG_TAG_ATTR)==i){if(1==b(t).attr("data-bd-imgshare-binded"))return;b(t).on("mouseenter",o).on("mouseleave",n),b(t).attr("data-bd-imgshare-binded",1)}}),function(){var e=["<div id='#{id}' class='sr-bdimgshare sr-bdimgshare-#{type} sr-bdimgshare-#{size} sr-bdimgshare-#{color}' style='height:#{height}px;line-height:#{lineHeight}px;font-size:#{fontSize}px;width:#{width}px;display:none;'>","<div class='bdimgshare-bg'></div>","<div class='bdimgshare-content bdsharebuttonbox bdshare-button-style#{style}-#{size}'>","<label class='bdimgshare-lbl'>#{text}</label>","#{list}","</div>","</div>"].join(""),i="<a href='#' onclick='return false;' class='bds_#{icon}' data-cmd='#{icon}' hidefocus></a>",t="list"==u.viewType,o=[];t&&b.each(u.viewList,function(e,t){o.push(b.string(i).format({icon:t}))}),o.push(b.string(i).format({icon:"more"}));var n={16:"36",24:"42",32:"48"},s={16:"33",24:"39",32:"45"},a=b.string(e).format({id:h,text:u.viewText||(t?"图片分享":"分享"),type:u.viewType,style:u.viewStyle,size:u.viewSize,color:u.viewColor,width:t?"auto":{16:"60",24:"71",32:"82"}[u.viewSize],height:(t?n:s)[u.viewSize],lineHeight:(t?n:s)[u.viewSize]-10,fontSize:{16:"12",24:"14",32:"14"}[u.viewSize],list:o.join("")});b("body").insertHTML("beforeEnd",a),r._entities=m=b("#"+h),m.on("mouseleave",function(){f.abort()}).on("mouseenter",function(){f.clearAbort()})}()},r._init=function(){},r._keepBarVisible=function(){f.clearAbort(),t=!0},r._getImageSrc=function(){return i.src},r._distory=function(){m.remove();var i=u.tag||"";b("img").each(function(e,t){i&&b(t).attr(s.CONFIG_TAG_ATTR)!=i||(b(t).off("mouseenter",o).off("mouseleave",n),b(t).removeAttr("data-bd-imgshare-binded"))})}},n.ViewBase)});